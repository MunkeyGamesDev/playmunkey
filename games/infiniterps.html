<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Infinite Rock Paper Scissors</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
body{margin:0;padding:0;font-family:'Press Start 2P',cursive;background:#91b4c3;display:flex;justify-content:center;align-items:center;height:100vh;overflow:hidden}
.container{width:90%;max-width:700px;height:90%;background:#c0c0c0;border:4px solid #000;border-radius:12px;box-shadow:inset -4px -4px #999,inset 4px 4px #fff;display:flex;flex-direction:column;align-items:center;padding:15px;box-sizing:border-box;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transition: all 0.5s;opacity:0;pointer-events:none}
.container.active{opacity:1;pointer-events:auto}
h1{font-size:2em;margin:0;margin-bottom:10px;text-align:center;animation:title-pulse 2s infinite;color:#fff;text-shadow:2px 2px 0 #000,4px 4px 0 #333}
@keyframes title-pulse{0%{color:#fff;text-shadow:2px 2px 0 #000,4px 4px 0 #333}25%{color:#ff0;text-shadow:2px 2px 0 #000,4px 4px 0 #666}50%{color:#f0f;text-shadow:2px 2px 0 #000,4px 4px 0 #999}75%{color:#0ff;text-shadow:2px 2px 0 #000,4px 4px 0 #666}100%{color:#fff;text-shadow:2px 2px 0 #000,4px 4px 0 #333}}
.button{padding:15px 25px;margin:10px;font-size:1em;background:#e0e0e0;border:2px solid #000;border-radius:8px;cursor:pointer;transition:all 0.2s;text-align:center}
.button:hover{transform:scale(1.1);background:#fff}
.choices{flex:1;display:flex;justify-content:center;align-items:center}
.choice-row{display:flex;gap:15px}
.choice{font-size:3em;background:#e0e0e0;border:2px solid #000;padding:15px;border-radius:8px;cursor:pointer;position:relative;transition:transform 0.2s}
.choice:hover{transform:scale(1.5) rotate(5deg)}
.choice:hover::after{content:attr(data-name);position:absolute;top:-2.5em;left:50%;transform:translateX(-50%);background:#000;color:#fff;font-size:0.6em;padding:2px 5px;border-radius:3px;white-space:nowrap}
.choice.disabled{opacity:0.5;pointer-events:none;}
.panel{width:100%;background:#c0c0c0;border:2px solid #000;padding:10px;margin-top:10px;box-sizing:border-box;min-height:60px;font-size:0.7em;color:#000;text-align:center;transition:all 0.3s}
.scoreboard{font-size:0.7em;margin-top:5px;padding:5px;background:#e0e0e0;border:2px solid #000;width:100%;text-align:center;position:relative}
.confetti-piece{position:absolute;width:10px;height:10px;background:red;opacity:0.8;pointer-events:none;animation:confetti-fall 2s linear forwards}
@keyframes confetti-fall{0%{transform:translateY(-10px) rotate(0deg)}100%{transform:translateY(100vh) rotate(720deg)}}
.new-set{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);font-size:3em;color:#ff0;text-shadow:2px 2px 0 #000,4px 4px 0 #333;pointer-events:none;animation:none;z-index:9999;text-align:center}
@keyframes new-set-anim{0%{transform:translate(-50%,-50%) scale(0);opacity:0}30%{transform:translate(-50%,-50%) scale(1.5);opacity:1}70%{transform:translate(-50%,-50%) scale(1.2);opacity:1}100%{transform:translate(-50%,-50%) scale(1);opacity:0}}
.menu{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%;text-align:center;}
.menu h1{font-size:2em;margin-bottom:20px}
.instructions{display:none;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px;font-size:0.8em;}
.instructions.active{display:flex;}
.back-btn{margin-top:20px;padding:10px 20px;border:2px solid #000;border-radius:8px;background:#e0e0e0;cursor:pointer;transition:all 0.2s}
.back-btn:hover{background:#fff}
.timer{position:absolute;top:10px;left:10px;font-size:0.8em;color:#fff;text-shadow:1px 1px 0 #000}
.you-won{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#c0c0c0;border:4px solid #000;padding:20px;border-radius:12px;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:1000}
.you-won input{padding:10px;font-size:1em;margin:10px;width:150px;text-align:center}
.you-won button{padding:10px 20px;font-size:1em;cursor:pointer;margin:5px}
.leaderboard{margin-top:10px;font-size:0.7em;text-align:center;width:100%;}
.multi-input-group{display:flex;flex-direction:column;align-items:center;margin:15px 0;}
.multi-input-group label{font-size:0.7em;margin-bottom:5px;color:#000;}
.multi-input-group input{padding:10px;font-size:1em;margin:10px;width:200px;text-align:center;border:2px solid #000;border-radius:5px;background:#fff;font-family:'Press Start 2P',cursive;}
.code-display{font-size:2em;color:#ff0;text-shadow:2px 2px 0 #000;margin:15px 0;padding:15px;background:#000;border-radius:8px;}
.status-box{margin:15px 0;padding:15px;background:#e0e0e0;border:2px solid #000;border-radius:8px;font-size:0.7em;text-align:center;}

</style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>

<div class="container active" id="menuContainer">
  <div class="menu">
    <h1>ğŸ® Infinite RPS ğŸ®</h1>
    <div class="button" id="startBtn">Start Game</div>
    <div class="button" id="multBtn">Multiplayer</div>
    <div class="button" id="leaderBtn">Leaderboard</div>
    <div class="button" id="instrBtn">Instructions</div>
  </div>
  <div class="instructions" id="instrPanel">
    <p>Rules: Basic Rock Paper Scissors... kinda. Each set has 3 options. Winning advances you to the next set and Losing decreases your level.</p>
    <div class="back-btn" id="backBtn">Back</div>
  </div>
  <div class="instructions" id="leaderPanel">
    <h2>ğŸ† LEADERBOARD ğŸ†</h2>
    <div id="leaderboardContent">Loading leaderboard...</div>
    <div class="back-btn" id="leaderBackBtn">Back</div>
  </div>
</div>

<div class="container" id="multiContainer">
  <h1>ğŸ® Multiplayer ğŸ®</h1>
  <div class="multi-input-group">
    <label>YOUR NAME</label>
    <input type="text" id="multiName" placeholder="Enter Name" maxlength="12">
  </div>
  <div class="button" id="createCodeBtn">Create Game</div>
  <div class="code-display" id="codeDisplay" style="display:none;"></div>
  <div class="multi-input-group">
    <label>OR JOIN GAME</label>
    <input type="text" id="joinCodeInput" placeholder="Enter Code" maxlength="4" style="text-transform:uppercase;">
  </div>
  <div class="button" id="joinCodeBtn">Join Game</div>
  <div class="status-box" id="multiStatus">Create or join a game to begin!</div>
  <div class="back-btn" id="multiBackBtn">Back</div>
</div>

<div class="container" id="gameContainer">
  <h1 id="title">ğŸ® Infinite RPS ğŸ®</h1>
  <div class="timer" id="timer">Time: 0s</div>
  <div class="choices"></div>
  <div class="panel result"></div>
  <div class="scoreboard">Level: 1 | Player: 0 | AI: 0</div>

  <div class="new-set" id="newSet">NEW SET UNLOCKED!</div>
</div>

<div class="you-won" id="youWonPanel">
  <h1 id="winTitle">You Won! ğŸ†</h1>
  <input type="text" id="playerName" placeholder="Enter Name" maxlength="12"/>
  <button id="submitScore">Submit Score</button>
  <div class="leaderboard" id="leaderboardDiv">Loading leaderboard...</div>
</div>

<script>
const SUPABASE_URL='https://gwiveqgfbslonwmvtluv.supabase.co';
const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd3aXZlcWdmYnNsb253bXZ0bHV2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4NTIxNTQsImV4cCI6MjA4NjQyODE1NH0.QEJDJXCURL-HxsFyIJmA6wLjLvnrIFLHnS_4ezL-quE';

const startBtn=document.getElementById('startBtn'),multBtn=document.getElementById('multBtn'),instrBtn=document.getElementById('instrBtn'),backBtn=document.getElementById('backBtn'),multiBackBtn=document.getElementById('multiBackBtn'),createCodeBtn=document.getElementById('createCodeBtn'),joinCodeBtn=document.getElementById('joinCodeBtn'),joinCodeInput=document.getElementById('joinCodeInput'),multiName=document.getElementById('multiName'),multiStatus=document.getElementById('multiStatus'),codeDisplay=document.getElementById('codeDisplay'),leaderBtn=document.getElementById('leaderBtn'),leaderBackBtn=document.getElementById('leaderBackBtn'),leaderPanel=document.getElementById('leaderPanel'),leaderboardContent=document.getElementById('leaderboardContent');
const menuContainer=document.getElementById('menuContainer'),instrPanel=document.getElementById('instrPanel'),multiContainer=document.getElementById('multiContainer'),gameContainer=document.getElementById('gameContainer'),choicesDiv=gameContainer.querySelector('.choices'),resultDiv=gameContainer.querySelector('.result'),scoreboard=gameContainer.querySelector('.scoreboard'),title=document.getElementById('title'),newSet=document.getElementById('newSet'),timerDiv=document.getElementById('timer'),youWonPanel=document.getElementById('youWonPanel'),playerNameInput=document.getElementById('playerName'),submitScoreBtn=document.getElementById('submitScore'),leaderboardDiv=document.getElementById('leaderboardDiv'),winTitle=document.getElementById('winTitle');

let playerScore=0,aiScore=0,currentLevel=0,startTime,timerInterval,multiplayer=false,myPlayer='a',gameCode='',pollInterval=null;
let playerHistory=[],lastPlayerChoice=null,repeatCount=0,lastRoundTime=0,spamDetected=false;
const optionSets=[['ğŸª¨','ğŸ“„','âœ‚ï¸'],['ğŸ¦„','ğŸŒˆ','ğŸ’©'],['ğŸ”¥','ğŸ’§','ğŸŒ±'],['âš¡','ğŸŒ','ğŸ‘½'],['ğŸ•','ğŸ”','ğŸŒ­'],['ğŸ™','ğŸ³','ğŸ¦–'],['ğŸŒ','ğŸŒœ','â­'],['ğŸ©','ğŸ•¶ï¸','ğŸ‘‘'],['ğŸ¤–','ğŸ‘¾','ğŸ‘»'],['ğŸ’','ğŸª™','ğŸ§¿'],['ğŸ¥³','ğŸ˜±','ğŸ¤¯']];
const emojiNames={'ğŸª¨':'Rock','ğŸ“„':'Paper','âœ‚ï¸':'Scissors','ğŸ¦„':'Unicorn','ğŸŒˆ':'Rainbow','ğŸ’©':'Poop','ğŸ”¥':'Fire','ğŸ’§':'Water','ğŸŒ±':'Plant','âš¡':'Lightning','ğŸŒ':'Banana','ğŸ‘½':'Alien','ğŸ•':'Pizza','ğŸ”':'Burger','ğŸŒ­':'Hotdog','ğŸ™':'Octopus','ğŸ³':'Whale','ğŸ¦–':'Dino','ğŸŒ':'Sun','ğŸŒœ':'Moon','â­':'Star','ğŸ©':'Hat','ğŸ•¶ï¸':'Sunglasses','ğŸ‘‘':'Crown','ğŸ¤–':'Robot','ğŸ‘¾':'Monster','ğŸ‘»':'Ghost','ğŸ’':'Gem','ğŸª™':'Coin','ğŸ§¿':'Amulet','ğŸ¥³':'Party','ğŸ˜±':'Scream','ğŸ¤¯':'Mindblown'};
const rowRules=[{'ğŸª¨':['âœ‚ï¸'],'ğŸ“„':['ğŸª¨'],'âœ‚ï¸':['ğŸ“„']},{'ğŸ¦„':['ğŸ’©'],'ğŸŒˆ':['ğŸ¦„'],'ğŸ’©':['ğŸŒˆ']},{'ğŸ”¥':['ğŸŒ±'],'ğŸ’§':['ğŸ”¥'],'ğŸŒ±':['ğŸ’§']},{'âš¡':['ğŸ‘½'],'ğŸŒ':['âš¡'],'ğŸ‘½':['ğŸŒ']},{'ğŸ•':['ğŸŒ­'],'ğŸ”':['ğŸ•'],'ğŸŒ­':['ğŸ”']},{'ğŸ™':['ğŸ¦–'],'ğŸ³':['ğŸ™'],'ğŸ¦–':['ğŸ³']},{'ğŸŒ':['â­'],'ğŸŒœ':['ğŸŒ'],'â­':['ğŸŒœ']},{'ğŸ©':['ğŸ‘‘'],'ğŸ•¶ï¸':['ğŸ©'],'ğŸ‘‘':['ğŸ•¶ï¸']},{'ğŸ¤–':['ğŸ‘»'],'ğŸ‘¾':['ğŸ¤–'],'ğŸ‘»':['ğŸ‘¾']},{'ğŸ’':['ğŸ§¿'],'ğŸª™':['ğŸ’'],'ğŸ§¿':['ğŸª™']},{'ğŸ¥³':['ğŸ¤¯'],'ğŸ˜±':['ğŸ¥³'],'ğŸ¤¯':['ğŸ˜±']}];


class SmartAI {
  constructor() {
    this.choiceHistory = [];
    this.patternCache = {};
    this.lastPlayerChoice = null;
    this.repeatCount = 0;
    this.lastRoundTime = 0;
    this.cooldownTime = 800;
    

    this.positionTally = {0: 0, 1: 0, 2: 0};
    this.positionHistory = [];
    this.currentOptions = [];
  }


  analyzePattern() {
    if (this.choiceHistory.length < 2) return null;
    

    const transitions = {};
    for (let i = 0; i < this.choiceHistory.length - 1; i++) {
      const current = this.choiceHistory[i];
      const next = this.choiceHistory[i + 1];
      if (!transitions[current]) transitions[current] = {};
      transitions[current][next] = (transitions[current][next] || 0) + 1;
    }


    const lastChoice = this.choiceHistory[this.choiceHistory.length - 1];
    if (transitions[lastChoice]) {
      const counts = transitions[lastChoice];
      let predicted = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
      return predicted;
    }
    return null;
  }


  detectSpam(playerChoice) {
    const now = Date.now();
    const timeSinceLastRound = now - this.lastRoundTime;
    

    if (playerChoice === this.lastPlayerChoice) {
      this.repeatCount++;
    } else {
      this.repeatCount = 0;
    }


    const isSpamming = this.repeatCount >= 2 || (timeSinceLastRound < this.cooldownTime && this.repeatCount >= 1);
    
    this.lastPlayerChoice = playerChoice;
    this.lastRoundTime = now;
    
    return isSpamming;
  }


  getCounterMove(predictedChoice) {
    const rules = rowRules[currentLevel];
    for (const [winner, losers] of Object.entries(rules)) {
      if (losers.includes(predictedChoice)) {
        return winner;
      }
    }

    return optionSets[currentLevel][Math.floor(Math.random() * 3)];
  }


  recordPosition(position) {
    this.positionTally[position]++;
    this.positionHistory.push(position);
    

    if (this.positionHistory.length > 20) {
      this.positionHistory.shift();
    }
  }


  getMostClickedPosition() {
    let maxCount = 0;
    let mostClicked = 1;
    
    for (const [position, count] of Object.entries(this.positionTally)) {
      if (count > maxCount) {
        maxCount = count;
        mostClicked = parseInt(position);
      }
    }
    
    return mostClicked;
  }


  predictFromPositionTally() {
    const mostClickedPos = this.getMostClickedPosition();
    

    const totalClicks = this.positionTally[0] + this.positionTally[1] + this.positionTally[2];
    if (totalClicks >= 3) {
      return this.currentOptions[mostClickedPos];
    }
    
    return null;
  }


  makeChoice(playerChoice, position) {

    this.recordPosition(position);
    
    const isSpamming = this.detectSpam(playerChoice);
    this.choiceHistory.push(playerChoice);
    

    if (this.choiceHistory.length > 10) {
      this.choiceHistory.shift();
    }


    if (isSpamming) {
      
      const counter = this.getCounterMove(playerChoice);
      return Math.random() < 0.9 ? counter : this.getRandomChoice();
    }


    const positionPrediction = this.predictFromPositionTally();
    if (positionPrediction && Math.random() < 0.65) {
      return this.getCounterMove(positionPrediction);
    }


    const predicted = this.analyzePattern();
    if (predicted && Math.random() < 0.7) {
      
      return this.getCounterMove(predicted);
    }


    
    return this.getRandomChoice();
  }

  getRandomChoice() {
    return optionSets[currentLevel][Math.floor(Math.random() * 3)];
  }

  reset() {
    this.choiceHistory = [];
    this.patternCache = {};
    this.lastPlayerChoice = null;
    this.repeatCount = 0;
    this.lastRoundTime = 0;
    this.positionTally = {0: 0, 1: 0, 2: 0};
    this.positionHistory = [];
    this.currentOptions = [];
    
  }
}

const smartAI = new SmartAI();

function updateChoices(){
  choicesDiv.innerHTML='';
  const rowDiv=document.createElement('div');
  rowDiv.classList.add('choice-row');
  

  smartAI.currentOptions = optionSets[currentLevel];
  
  optionSets[currentLevel].forEach((e, index) => {
    const div=document.createElement('div');
    div.classList.add('choice');
    div.textContent=e;
    div.setAttribute('data-name',emojiNames[e]);
    div.setAttribute('data-position', index);
    div.addEventListener('click',()=>playRound(e, index));
    rowDiv.appendChild(div);
  });
  choicesDiv.appendChild(rowDiv);
}

function createConfetti(){for(let i=0;i<50;i++){const c=document.createElement('div');c.classList.add('confetti-piece');c.style.left=Math.random()*window.innerWidth+'px';c.style.background=`hsl(${Math.random()*360},100%,50%)`;c.style.animationDuration=(Math.random()*2+1)+'s';document.body.appendChild(c);setTimeout(()=>c.remove(),2000);}}
function animateWin(){createConfetti();newSet.style.animation='new-set-anim 1.5s forwards';}
function startTimer(){startTime=Date.now();timerInterval=setInterval(()=>{const elapsed=Math.floor((Date.now()-startTime)/1000);timerDiv.textContent=`Time: ${elapsed}s`;},1000);}
function stopTimer(){clearInterval(timerInterval);}
async function fetchLeaderboard(){try{const res=await fetch(`${SUPABASE_URL}/rest/v1/leaderboard?order=time.asc&limit=10`,{headers:{apikey:SUPABASE_KEY,'Authorization':`Bearer ${SUPABASE_KEY}`}});const data=await res.json();leaderboardDiv.innerHTML=data.map((entry,i)=>`${i+1}. ${entry.name} - ${entry.time}s`).join('<br>');}catch(err){leaderboardDiv.textContent='Failed to load leaderboard.';}}
async function fetchLeaderboardPanel(){try{const res=await fetch(`${SUPABASE_URL}/rest/v1/leaderboard?order=time.asc&limit=10`,{headers:{apikey:SUPABASE_KEY,'Authorization':`Bearer ${SUPABASE_KEY}`}});const data=await res.json();leaderboardContent.innerHTML=data.map((entry,i)=>`${i+1}. ${entry.name} - ${entry.time}s`).join('<br>');}catch(err){leaderboardContent.textContent='Failed to load leaderboard.';}}
async function submitScore(name,time){await fetch(`${SUPABASE_URL}/rest/v1/leaderboard`,{method:'POST',headers:{'apikey':SUPABASE_KEY,'Authorization':`Bearer ${SUPABASE_KEY}`,'Content-Type':'application/json'},body:JSON.stringify({name,time})});await fetchLeaderboard();}
async function getGame(code){const res=await fetch(`${SUPABASE_URL}/rest/v1/multigames?code=eq.${code}&select=*`,{headers:{apikey:SUPABASE_KEY,'Authorization':`Bearer ${SUPABASE_KEY}`}});const data=await res.json();return data[0];}
async function createGame(code,playerName){const res=await fetch(`${SUPABASE_URL}/rest/v1/multigames`,{method:'POST',headers:{'apikey':SUPABASE_KEY,'Authorization':`Bearer ${SUPABASE_KEY}`,'Content-Type':'application/json'},body:JSON.stringify({code,player_a:playerName,player_b:'',choice_a:'',choice_b:'',status:'waiting',level:0,score_a:0,score_b:0})});return res.ok;}
async function joinGame(code,playerName){const game=await getGame(code);if(!game||game.status!=='waiting'){return false;}const res=await fetch(`${SUPABASE_URL}/rest/v1/multigames?id=eq.${game.id}`,{method:'PATCH',headers:{'apikey':SUPABASE_KEY,'Authorization':`Bearer ${SUPABASE_KEY}`,'Content-Type':'application/json'},body:JSON.stringify({player_b:playerName,status:'playing'})});return res.ok;}
async function updateChoice(code,player,choice){const game=await getGame(code);if(!game)return;const field=player==='a'?'choice_a':'choice_b';await fetch(`${SUPABASE_URL}/rest/v1/multigames?id=eq.${game.id}`,{method:'PATCH',headers:{'apikey':SUPABASE_KEY,'Authorization':`Bearer ${SUPABASE_KEY}`,'Content-Type':'application/json'},body:JSON.stringify({[field]:choice})});}
async function resetRound(code,level,scoreA,scoreB){const game=await getGame(code);if(!game)return;await fetch(`${SUPABASE_URL}/rest/v1/multigames?id=eq.${game.id}`,{method:'PATCH',headers:{'apikey':SUPABASE_KEY,'Authorization':`Bearer ${SUPABASE_KEY}`,'Content-Type':'application/json'},body:JSON.stringify({choice_a:'',choice_b:'',level,score_a:scoreA,score_b:scoreB})});}
async function pollGame(){if(!gameCode){clearInterval(pollInterval);return;}const game=await getGame(gameCode);if(!game){clearInterval(pollInterval);return;}if(game.status==='waiting'){multiStatus.textContent=`Waiting for opponent...`;codeDisplay.textContent=gameCode;codeDisplay.style.display='block';}else if(game.status==='playing'){if(!multiplayer){multiplayer=true;clearInterval(pollInterval);multiContainer.classList.remove('active');gameContainer.classList.add('active');title.textContent=`ğŸ® ${game.player_a} vs ${game.player_b} ğŸ®`;currentLevel=game.level;updateChoices();startTimer();startMultiplayerPoll();}}}
function startMultiplayerPoll(){pollInterval=setInterval(async()=>{const game=await getGame(gameCode);if(!game){clearInterval(pollInterval);return;}const myChoice=myPlayer==='a'?game.choice_a:game.choice_b;const oppChoice=myPlayer==='a'?game.choice_b:game.choice_a;if(myChoice&&!oppChoice){resultDiv.textContent='Waiting for opponent...';}if(myChoice&&oppChoice){let oppName=myPlayer==='a'?game.player_b:game.player_a;let text=`${oppName} chose ${oppChoice} (${emojiNames[oppChoice]})! `;let roundWinner='';if(myChoice===oppChoice){text+="It's a tie! ğŸ¤";roundWinner='tie';}else if(emojiBeats(myChoice,oppChoice)){text+="You win this round! ğŸ‰";roundWinner='me';if(myPlayer==='a'){game.score_a++;}else{game.score_b++;}}else{text+="Opponent wins this round! ğŸ˜­";roundWinner='opp';if(myPlayer==='a'){game.score_b++;}else{game.score_a++;}}if(game.level<optionSets.length-1){game.level++;animateWin();resultDiv.innerHTML=text+'<br>Next Set! â¡ï¸';scoreboard.textContent=`Set: ${game.level+1}/${optionSets.length} | ${game.player_a}: ${game.score_a} | ${game.player_b}: ${game.score_b}`;currentLevel=game.level;playerScore=myPlayer==='a'?game.score_a:game.score_b;aiScore=myPlayer==='a'?game.score_b:game.score_a;setTimeout(async()=>{await resetRound(gameCode,game.level,game.score_a,game.score_b);updateChoices();setTimeout(()=>{newSet.style.animation='none';},1500);},1500);}else{clearInterval(pollInterval);stopTimer();scoreboard.textContent=`Final Score | ${game.player_a}: ${game.score_a} | ${game.player_b}: ${game.score_b}`;let finalResult='';if(game.score_a>game.score_b){finalResult=game.player_a+' wins the match! ğŸ†';}else if(game.score_b>game.score_a){finalResult=game.player_b+' wins the match! ğŸ†';}else{finalResult="It's a tie! ğŸ¤";}resultDiv.innerHTML=text+'<br><br>'+finalResult;if((myPlayer==='a'&&game.score_a>game.score_b)||(myPlayer==='b'&&game.score_b>game.score_a)){winTitle.textContent='You Won! ğŸ†';}else if((myPlayer==='a'&&game.score_a<game.score_b)||(myPlayer==='b'&&game.score_b<game.score_a)){winTitle.textContent='You Lost! ğŸ˜¢';}else{winTitle.textContent='It\'s a Tie! ğŸ¤';}youWonPanel.style.display='flex';fetchLeaderboard();return;}}},500);}
function emojiBeats(player,ai){return rowRules[currentLevel][player].includes(ai);}
function playRound(player, position){if(multiplayer){updateChoice(gameCode,myPlayer,player);return;}const ai=smartAI.makeChoice(player, position);let text=`AI chose ${ai} (${emojiNames[ai]})! `;let advanced=false;if(player===ai){text+="It's a tie! ğŸ¤";}else if(emojiBeats(player,ai)){text+="You win! ğŸ‰";playerScore++;if(currentLevel<optionSets.length-1){currentLevel++;advanced=true;animateWin();} else {stopTimer();youWonPanel.style.display='flex';fetchLeaderboard();return;}}else{text+="You lose! ğŸ˜­";aiScore++;if(currentLevel>0) currentLevel--;}resultDiv.innerHTML=text;scoreboard.textContent=`Level: ${currentLevel+1} | Player: ${playerScore} | AI: ${aiScore}`;updateChoices();if(advanced){setTimeout(()=>{newSet.style.animation='none';},1500);}}

startBtn.addEventListener('click',()=>{menuContainer.classList.remove('active');instrPanel.classList.remove('active');gameContainer.classList.add('active');playerScore=0;aiScore=0;currentLevel=0;multiplayer=false;smartAI.reset();updateChoices();startTimer();});
instrBtn.addEventListener('click',()=>{instrPanel.classList.add('active');});
backBtn.addEventListener('click',()=>{instrPanel.classList.remove('active');});
multBtn.addEventListener('click',()=>{menuContainer.classList.remove('active');multiContainer.classList.add('active');});
leaderBtn.addEventListener('click',()=>{leaderPanel.classList.add('active');fetchLeaderboardPanel();});
leaderBackBtn.addEventListener('click',()=>{leaderPanel.classList.remove('active');});
multiBackBtn.addEventListener('click',()=>{if(pollInterval)clearInterval(pollInterval);multiContainer.classList.remove('active');menuContainer.classList.add('active');codeDisplay.style.display='none';codeDisplay.textContent='';});
createCodeBtn.addEventListener('click',async()=>{const name=multiName.value.trim();if(!name){multiStatus.textContent='Please enter your name.';return;}const code=Math.random().toString(36).substring(2,6).toUpperCase();gameCode=code;myPlayer='a';await createGame(code,name);multiStatus.textContent='Game created! Share code with friend:';codeDisplay.textContent=code;codeDisplay.style.display='block';pollInterval=setInterval(pollGame,1000);});
joinCodeBtn.addEventListener('click',async()=>{const name=multiName.value.trim();const code=joinCodeInput.value.trim().toUpperCase();if(!name||!code){multiStatus.textContent='Please enter your name and code.';return;}const success=await joinGame(code,name);if(success){gameCode=code;myPlayer='b';multiStatus.textContent='Joined game! Waiting for host to start...';pollInterval=setInterval(pollGame,1000);}else{multiStatus.textContent='Invalid code or game already started.';}});
submitScoreBtn.addEventListener('click',()=>{const name=playerNameInput.value.trim()||'Anonymous';const elapsed=Math.floor((Date.now()-startTime)/1000);submitScore(name,elapsed);youWonPanel.style.display='none';menuContainer.classList.add('active');playerNameInput.value='';});
</script>
</body>
</html>
